<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CDN Incident Alert Generator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://unpkg.com/docx@7.1.0/build/index.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <link rel="stylesheet" href="CDN report generator style.css">
</head>
<body>
    <h1>CDN Incident Alert Generator</h1>
    
    <div class="tabs">
        <button class="tab-button active" onclick="openTab(event, 'form-tab')">Input Form</button>
    </div>
    
    <div id="form-tab" class="tab-content" style="display: block;">
        <div class="section">
            <h2>Header Information</h2>
            <label for="incidentNumber" class="required">Incident Number:</label>
            <input type="text" id="incidentNumber" placeholder="e.g., 0001" title="The Number of this incident alert e.g. 0001">
            
            <label for="tlpLevel" class="required">TLP Level:</label>
            <select id="tlpLevel" title="Choose the TLP level for this incident report">
                <option value="TLP: RED">TLP: RED</option>
                <option value="TLP: AMBER+STRICT">TLP: AMBER+STRICT</option>
                <option value="TLP: AMBER">TLP: AMBER</option>
                <option value="TLP: GREEN">TLP: GREEN</option>
                <option value="TLP: CLEAR" selected>TLP: CLEAR</option>
            </select>
            
            <label for="country" class="required">Country/Region:</label>
            <select id="country" multiple title="Choose the country or region being targeted (hold Ctrl/Cmd to select multiple)">
                <option value="AL">AL</option>
                <option value="AT">AT</option>
                <option value="BE">BE</option>
                <option value="BA">BA</option>
                <option value="BG">BG</option>
                <option value="HR">HR</option>
                <option value="CY">CY</option>
                <option value="CZ">CZ</option>
                <option value="DK">DK</option>
                <option value="EE">EE</option>
                <option value="EU">EU</option>
                <option value="FI">FI</option>
                <option value="FR">FR</option>
                <option value="GE">GE</option>
                <option value="GB">GB</option>
                <option value="DE">DE</option>
                <option value="EL">EL</option>
                <option value="GR">GR</option>
                <option value="HU">HU</option>
                <option value="IS">IS</option>
                <option value="IE">IE</option>
                <option value="IT">IT</option>
                <option value="XK">XK</option>
                <option value="LV">LV</option>
                <option value="LI">LI</option>
                <option value="LT">LT</option>
                <option value="LU">LU</option>
                <option value="MT">MT</option>
                <option value="MD">MD</option>
                <option value="ME">ME</option>
                <option value="NL">NL</option>
                <option value="MK">MK</option>
                <option value="NO">NO</option>
                <option value="PL">PL</option>
                <option value="PT">PT</option>
                <option value="RO">RO</option>
                <option value="RS">RS</option>
                <option value="SK">SK</option>
                <option value="SI">SI</option>
                <option value="ES">ES</option>
                <option value="SE">SE</option>
                <option value="CH">CH</option>
                <option value="TR">TR</option>
                <option value="UA">UA</option>
                <option value="UK">UK</option>
            </select>
            
            <label for="title" class="required">Title:</label>
            <input type="text" id="title" placeholder="Create a title for this incident alert" title="Title of the incident alert" value="">
            
            <label for="date" class="required">Date:</label>
            <input
                type="date"
                id="date"
                name="date"
                required
                title="Choose the publication date for this incident"
                style="min-width:180px;"
            >
        </div>
        
        <div class="section">
            <h2>Summary</h2>
            <p class="help-text">Write a concise summary of the incident (1-2 sentences each for incident, narrative, impact, DISARM TTPs, and recommendations)</p>
            <div class="form-row">
                <label for="summary-incident" class="fixed-label">Incident</label>
                <input type="text" id="summary-incident" class="fixed-input" placeholder="Enter a summary of the incident in 1-2 sentences" title="Enter summary of incident" value="">                
            </div>
            <div class="form-row">    
                <label for="summary-narrative" class="fixed-label">Narrative</label>
                <input type="text" id="summary-narrative" class="fixed-input" placeholder="Enter a summary of the key narrative in 1 sentence" title="Enter summary of narrative" value="">                            
            </div>
            <div class="form-row">    
                <label for="summary-impact" class="fixed-label">Impact</label>
                <input type="text" id="summary-impact" class="fixed-input" placeholder="Enter a summary of the impact in 1 sentence" title="Enter summary of impact" value="">                            
            </div>
            <div class="form-row">    
                <label for="summary-ttps" class="fixed-label">DISARM TTPs</label>
                <input type="text" id="summary-ttps" class="fixed-input" placeholder="Indicate the key DISARM tactics and techniques" title="Enter summary of DISARM TTPs" value="">                            
            </div> 
            <div class="form-row">    
                <label for="summary-recommendations" class="fixed-label">Recommendations</label>
                <input type="text" id="summary-recommendations" class="fixed-input" placeholder="Indicate the key actions taken and the key recommendations" title="Enter summary of recommendations" value="">                            
            </div>
        </div>
        
        <div class="section">
            <h2>Incident</h2>
            <p class="help-text">Describe when, who did what, to say what, to whom, and why.</p>
            <textarea id="incident" placeholder="Begin with the date of the first observed activity or piece of content" title="Describe the scope of what you found..."></textarea>
        </div>
        
        <div class="section">
            <h2>Narrative</h2>
            <label for="metaNarrative">Meta Narrative:</label>
            <textarea id="metaNarrative" placeholder="Describe the overall narrative..." title="The overall narrative of the incident"></textarea>
            
            <div id="subNarratives-container">
                <div class="sub-narrative-entry">
                    <label>Sub-Narrative 1:</label>
                    <textarea class="sub-narrative-text" placeholder="Enter sub-narrative 1..." title="Specific sub-narrative"></textarea>
                </div>
            </div>
            <button type="button" class="add-button" onclick="addSubNarrative()">Add Sub-Narrative</button>
        </div>
        
        <div class="section">
            <h2>Impact</h2>
            <label for="reach">Reach:</label>
            <textarea id="reach" placeholder="Describe the reach of the incident..." title="Measure(s) of how extensively the incident became visible"></textarea>
            
            <label for="outcome">Outcome:</label>
            <textarea id="outcome" placeholder="Describe any real-life outcomes..." title="Did the incident break into public discourse or cause any offline events?"></textarea>
        </div>
        
        <div class="section">
            <h2>Key Objectives and Behaviors (DISARM Framework)</h2>
            <div class="help-text objectives-help-row">
                <span>
                    Select 2 objectives and 4 TTPs from the 
                    <a href="https://disarmfoundation.github.io/disarm-navigator/" target="_blank">DISARM Framework.</a>
                    Enter manually, use the interactive framework, or upload from Navigator layer file.
                </span>
                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                    <button type="button" class="add-button" onclick="openDISARMFramework()">Interactive DISARM Framework</button>
                    <button type="button" class="add-button" onclick="uploadNavigatorFile()">Upload from Navigator layer file</button>
                </div>
            </div>
            <div id="objectives-container">
                <div class="objective-entry">
                    <label>Objective 1:</label>
                    <input type="text" class="objective-title" placeholder="DISARM name for objective" title="Choose a technique under TA01 Plan Strategy or TA02 Plan Objectives" value="">
                    <textarea class="objective-justification" placeholder="Justification for objective 1" title="Why did you choose this objective?"></textarea>
                </div>
                <div class="objective-entry">
                    <label>Objective 2:</label>
                    <input type="text" class="objective-title" placeholder="DISARM name for objective" title="Choose a technique under TA01 Plan Strategy or TA02 Plan Objectives" value="">
                    <textarea class="objective-justification" placeholder="Justification for objective 2" title="Why did you choose this objective?"></textarea>
                </div>
            </div>
            
            <div id="ttps-container">
                <div class="ttp-entry">
                    <label>TTP 1:</label>
                    <input type="text" class="ttp-title" placeholder="DISARM name for TTP" title="Choose the name of a DISARM tactic or technique" value="">
                    <textarea class="ttp-explanation" placeholder="Explanation for TTP 1" title="Explain why you chose this TTP"></textarea>
                </div>
            </div>
            
            <button type="button" class="add-button" id="addTTPButton" onclick="addTTP()">Add TTP</button>
        </div>
        
        <div class="section">
            <h2>Recommendations and Actions Taken</h2>
            <label for="actionsTaken">Actions Taken:</label>
            <textarea id="actionsTaken" placeholder="E.g., reported network to Meta and X..." title="What actions did you take to respond to this incident?"></textarea>
            
            <div id="recommendations-container">
                <div class="recommendation-entry">
                    <label>Recommendation 1:</label>
                    <textarea class="recommendation-text" placeholder="Enter recommendation 1..." title="What further actions would you recommend?"></textarea>
                </div>
            </div>
            <button type="button" class="add-button" onclick="addRecommendation()">Add Recommendation</button>
        </div>
       
        <div class="section">
            <h2>Details</h2>
            <table id="evidence-table" style="width:100%; border-collapse:collapse;">
                <thead>
                    <tr class="header-row">
                        <th>Report</th>
                        <th>Threat Actor</th>
                        <th>Evidence</th>
                        <th>Authors</th>
                        <th>Platforms</th>
                        <th>Logo</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody id="evidence-rows-container">
                    <tr class="evidence-row">
                        <td>
                            <input type="text" id="reporturlInput" class="evidence-report-url" placeholder="URL" 
                                   title="Please enter a valid URL starting with http:// or https://">
                        </td>
                        <td><input type="text" class="evidence-threat" placeholder="Russia, China etc." title="Threat Actor(s)"></td>
                        <td>
                            <input type="text" id="evidenceurlInput" class="evidence-evidence-link" placeholder="URL" 
                                   title="Please enter a valid URL starting with http:// or https://">
                        </td>
                        <td>
                            <div class="evidence-authors"></div>
                            <button type="button" class="add-button" onclick="addAuthor(this)">Add Author</button>
                        </td>
                        <td><input type="text" class="evidence-platforms" placeholder="e.g. Facebook, X, YouTube." title="Platforms"></td>
                        <td>
                            <img class="evidence-logo" id="imagePreview" alt="No image uploaded yet" />
                            <button class="add-button" onclick="triggerFilePicker()">Upload Logo</button>
                            <input type="file" id="logoFileInput" accept="image/*" title="Please upload a JPEG, PNG, BMP, or GIF image." style="display:none" onchange="previewImage(event)">
                        </td> 
                    </tr>
                </tbody>
            </table>
        </div>
        <div id="reporturlError" style="color: red; margin-top: 5px; text-align: left;"></div>
        <div id="evidenceurlError" style="color: red; margin-top: 5px; text-align: left;"></div>        
        <div id="logo-message" style="color: red; margin-top: 5px; text-align: right;"></div>
        
        <div class="buttons">
            <button type="button" onclick="downloadAsDocx()">Download DOCX</button>
        </div>
    </div> 
   
    <div id="authorModal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.3); z-index:1000;">
        <div style="background:white; padding:20px; border-radius:8px; width:300px; margin:100px auto;">
            <h3>Add Author</h3>
            <label>Name: <input type="text" id="modalAuthorName"></label><br><br>
            <label>Organization: <input type="text" id="modalAuthorOrg"></label><br><br>
            <button onclick="submitAuthorModal()">OK</button>
            <button onclick="closeAuthorModal()">Cancel</button>
        </div>
    </div>

    <!-- Module Scripts - Load in dependency order -->
    <script src="config.js" defer></script>
    <script src="form-data-processing.js" defer></script>
    <script src="disarm-framework-integration.js" defer></script>
    <script src="objectives-ttps-management.js" defer></script>
    <script src="url-validation.js" defer></script>
    <script src="ui-interactions.js" defer></script>
    <script src="docx-header-tables.js" defer></script>
    <script src="docx-summary-table.js" defer></script>
    <script src="docx-content-tables.js" defer></script>
    <script src="docx-footer-tables.js" defer></script>
    <script src="docx-generator.js" defer></script>
    <script src="image-handling.js" defer></script>
    <script src="main.js" defer></script>

</body>
</html>